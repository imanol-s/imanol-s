<button
  type="button"
  data-command-palette-hint
  class="fixed bottom-4 right-4 z-40 inline-flex items-center gap-2 rounded-sm border border-slate-200 bg-slate-50 px-3 py-1.5 text-xs font-display font-medium text-slate-700 shadow-sm hover:bg-white focus-ring dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800"
  aria-label="Open command palette"
>
  <span class="text-slate-500 dark:text-slate-400">Quick actions</span>
  <span class="inline-flex items-center gap-1">
    <kbd
      data-command-modifier
      class="inline-flex h-6 min-w-[1.5rem] items-center justify-center rounded-sm border border-slate-200 bg-white px-2 text-sm font-semibold leading-none text-slate-700 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-200"
      aria-hidden="true"
    >
      ⌃
    </kbd>
    <span
      class="inline-flex h-6 items-center justify-center px-0.5 text-xs font-semibold text-slate-500 dark:text-slate-400"
      aria-hidden="true"
    >
      +
    </span>
    <kbd
      class="inline-flex h-6 min-w-[1.5rem] items-center justify-center rounded-sm border border-slate-200 bg-white px-2 text-sm font-semibold leading-none text-slate-700 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-200"
      aria-hidden="true"
    >
      K
    </kbd>
  </span>
  <span data-command-shortcut-label class="sr-only">Ctrl + K</span>
</button>

<script is:inline>
  const HINT_SELECTOR = "[data-command-palette-hint]";
  const MODIFIER_SELECTOR = "[data-command-modifier]";
  const LABEL_SELECTOR = "[data-command-shortcut-label]";
  const OPEN_EVENT = "command-palette:open";

  function initCommandPaletteHint() {
    const hint = document.querySelector(HINT_SELECTOR);
    if (!(hint instanceof HTMLButtonElement) || hint.dataset.bound === "true") {
      return;
    }

    hint.dataset.bound = "true";

    const modifier = hint.querySelector(MODIFIER_SELECTOR);
    const label = hint.querySelector(LABEL_SELECTOR);
    if (modifier instanceof HTMLElement) {
      const userAgent = navigator.userAgent || "";
      const isMac = /Mac|iPhone|iPad|iPod/i.test(userAgent);
      modifier.textContent = isMac ? "⌘" : "⌃";
      if (label instanceof HTMLElement) {
        label.textContent = isMac ? "Command + K" : "Control + K";
      }
    }

    hint.addEventListener("click", () => {
      window.dispatchEvent(new CustomEvent(OPEN_EVENT));
    });
  }

  initCommandPaletteHint();
  document.addEventListener("astro:after-swap", initCommandPaletteHint);
</script>

# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Personal portfolio site for Imanol Saldana, built with Astro 5, React 18, Tailwind CSS 4, and TypeScript. Deployed at https://imanols.dev via Netlify.

## Commands

- `npm run dev` — Start dev server
- `npm run build` — Type-check via `astro check` then build (`astro check && astro build`)
- `npm run preview` — Preview production build locally

No test framework is configured.

## Architecture

**Astro + React island pattern**: Most components are `.astro` files (server-rendered). React (`.tsx`) is only used where client-side interactivity is needed:
- `TopoBackground.tsx` — animated SVG background (`client:only="react"`)
- `TypewriterText.tsx` — hero name animation (`client:load`)

**Content collections** (`src/content/config.ts`): Two collections using Astro's glob loader:
- `posts` — Markdown/MDX blog posts in `src/content/posts/`, schema requires `publishDate`, `title`, `tags`, `description`, `cover` image
- `projects` — MDX project pages in `src/content/projects/`, schema requires `title`, `startDate`, `endDate`, `summary`, `cover` image, `tags`, `ogImage`; `url` is optional

**Site configuration** (`src/config.ts`): Central config exports `SITE` (metadata, SEO), `ME` (profile info, contact details), and `SOCIALS` (social links with show/hide toggle).

**Static data files** (`src/data/`): Work experience (`Jobs.ts`) and education (`education.ts`) — typed TypeScript exports.

**Routing**: File-based in `src/pages/` with dynamic `[id].astro` routes:
- `/` — Home page (hero, projects, experience timeline, tech specs, about)
- `/projects` — Project listing
- `/projects/[id]` — Project detail with two-column MDX layout
- `/blog` — Blog listing
- `/blog/[id]` — Blog post
- `/404` — Not found

**Sitemap**: Auto-generated by `@astrojs/sitemap` integration on build.

## Styling

- **Tailwind CSS 4** with CSS-first config in `src/styles/globals.css` — `@theme {}` block defines all tokens, `@plugin` for typography
- **Dark mode**: Class-based via `<html class="dark">` (set by inline script in Layout.astro). Always use `.dark` prefix in custom CSS or `dark:` in Tailwind classes
- **Design system**: Blueprint/topographic theme — slate palette with `#64748b` primary
- **Fonts**: JetBrains Mono (`font-display`) for headings/nav/CTAs, Inter (`font-body`) for body text. Loaded via Google Fonts in Layout.astro `<head>`
- **Container**: `max-w-7xl mx-auto px-6` (wider than old design)
- **Custom utility classes** in `globals.css`: `cad-border`, `cta-primary`, `drawing-hover`, `focus-ring`, `grid-pulse`, `horizontal-scroll-snap`, `typing-caret`, `project-mdx`, background layers (`blueprint-grid`, `motion-topography`, `isometric-topography`, `topo-lines`)
- Blog prose uses `@tailwindcss/typography` `.prose` class with custom color overrides in globals.css

## Color Tokens

| Token | Hex | Usage |
|---|---|---|
| `primary` | `#64748b` | Accents, hover, CTAs, timeline dots, caret |
| `accent` | `#94a3b8` | Secondary borders, grid lines, scrollbar |
| `background-light` | `#f8fafc` | Page bg (light) |
| `background-dark` | `#0f172a` | Page bg (dark, always active) |

Text roles: `slate-900`/`white` (strong), `slate-800`/`200` (primary), `slate-600`/`400` (meta), `slate-500` (muted/labels)

## Components

**Shared layout** (every page):
- `Layout.astro` — SEO head, font preloads, dark mode init, TopoBackground, SiteHeader, SiteFooter
- `SiteHeader.astro` — Sticky nav with logo, section links, resume download, mobile hamburger
- `SiteFooter.astro` — Contact CTA, social links (GitHub/LinkedIn from config.ts), copyright
- `TopoBackground.tsx` — React island: animated SVG contours + parallax + seed cycling

**Blog** (kept from original):
- `PostCard.astro`, `BackBtn.astro`, `BackToTop.astro`

## Icons

Uses inline SVGs for all icons (GitHub, LinkedIn, Download, language icons). The `astro-icon` package is still installed for legacy blog icons in `src/icons/`.

## Security

**XSS Prevention**: Never use `innerHTML` with user-controlled data. Always use `textContent` for plain text or build DOM elements explicitly with `createElement()` + `textContent`. See `.github/copilot-instructions.md` for detailed examples.

## Gotchas

- **Shiki theme**: Code blocks use the `plastic` theme with wrapping enabled (configured in `astro.config.mjs`)
- **TypewriterText SSR**: Uses `typeof window !== "undefined"` guard for `window.matchMedia` — safe with `client:load`
- **TopoBackground**: Must use `client:only="react"` (browser-only rAF loop, `useRef` for SVG elements)
- **Tailwind v4 scoped styles**: Astro `<style>` blocks cannot use `@apply` with Tailwind classes unless `@reference` is added. Prefer plain CSS in scoped styles.
- **No `cn()` utility**: Removed with shadcn migration. Use template literals or ternaries for conditional classes.

## Pull Requests

When creating PRs, use plain bullet points (`-`) for test plans — NOT checkboxes (`- [ ]`). Checkboxes create dangling unchecked items that never get updated. The test plan is informational for the reviewer, not a tracking checklist.

## Deployment

Hosted on **Netlify** with build config in `netlify.toml`. DNS managed via Netlify DNS for `imanols.dev`. See `docs/NETLIFY_SUBDOMAINS.md` for subdomain setup workflow.

## Communication Style

When I ask a high-level or advisory question, give a direct conversational answer first before exploring the codebase. Only use tools if I explicitly ask you to investigate.

## Task Agents / Parallel Work

When I say "use task-distributor" or "use parallel agents", use the Task tool to spawn sub-agents. Do NOT overcomplicate with separate plugin specs or permission scaffolding — keep it simple with direct file creation.

## Session Management

Be aware of context window limits. For large multi-phase projects, complete one phase fully and write a handoff document before starting the next. Don't launch many parallel agents simultaneously.

## MCP Servers

An **Astro Docs MCP server** is available. Use it to look up Astro API references, configuration options, and component patterns instead of guessing or searching the web.
